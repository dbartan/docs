---
title: "Mimari Genel Bakış"
description: "Saha Kontrol Uygulaması'nın teknik mimarisi"
---

## Sistem Mimarisi

Saha Kontrol Uygulaması, **mobil-first** mimarisi ile tasarlanmıştır. Uygulama, çevrimdışı çalışma, gerçek zamanlı senkronizasyon ve kapsamlı veri yönetimi özellikleri sunar.

```
┌─────────────────────────────────────────────────────────────┐
│                    Mobil Uygulama (React Native)            │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  UI Layer (Ekranlar, Bileşenler, Navigasyon)        │  │
│  └──────────────────────────────────────────────────────┘  │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  Business Logic (Hooks, Context, State Management)  │  │
│  └──────────────────────────────────────────────────────┘  │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  Data Layer (AsyncStorage, SQLite, tRPC Client)     │  │
│  └──────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│                    Backend Server (Node.js)                 │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  tRPC API (RPC Endpoints)                            │  │
│  └──────────────────────────────────────────────────────┘  │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  Business Logic (Services, Validators)              │  │
│  └──────────────────────────────────────────────────────┘  │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  Database Layer (Drizzle ORM)                        │  │
│  └──────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│                    Database (MySQL/TiDB)                    │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  Projects, Documents, Inspections, Defects, Reports │  │
│  └──────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
```

## Katmanlar (Layers)

### 1. Sunum Katmanı (Presentation Layer)

**Teknoloji:** React Native, TypeScript, React Navigation

**Sorumluluğu:**
- Kullanıcı arayüzü bileşenleri
- Ekran navigasyonu
- Kullanıcı etkileşimleri
- Tema ve stil yönetimi

**Dosya Yapısı:**
```
app/
├── (tabs)/
│   ├── index.tsx              # Ana Sayfa
│   ├── documents.tsx          # Dokümanlar
│   ├── inspections.tsx        # Kontroller
│   ├── reports.tsx            # Raporlar
│   └── settings.tsx           # Ayarlar
├── modal.tsx                  # Modal Ekranları
└── _layout.tsx                # Navigasyon Yapısı
```

### 2. İş Mantığı Katmanı (Business Logic Layer)

**Teknoloji:** React Hooks, Context API, Custom Hooks

**Sorumluluğu:**
- Veri işleme ve dönüştürme
- Doğrulama (Validation)
- İş kuralları uygulanması
- Durum yönetimi

**Dosya Yapısı:**
```
hooks/
├── use-auth.ts                # Kimlik doğrulama
├── use-projects.ts            # Proje yönetimi
├── use-inspections.ts         # Kontrol listeleri
├── use-defects.ts             # Uygunsuzluk yönetimi
└── use-reports.ts             # Raporlama

lib/
├── validators.ts              # Doğrulama fonksiyonları
├── formatters.ts              # Veri biçimlendirme
└── helpers.ts                 # Yardımcı fonksiyonlar
```

### 3. Veri Katmanı (Data Layer)

**Teknoloji:** AsyncStorage, SQLite, tRPC Client

**Sorumluluğu:**
- Yerel veri depolama
- Sunucu iletişimi
- Senkronizasyon
- Veri şifreleme

**Dosya Yapısı:**
```
lib/
├── storage.ts                 # AsyncStorage/SQLite
├── trpc.ts                    # tRPC Client
├── sync.ts                    # Senkronizasyon
└── encryption.ts              # Şifreleme

data/
├── models/                    # Veri modelleri
├── migrations/                # Veritabanı migrasyonları
└── seeds/                     # Test verileri
```

### 4. Backend Katmanı (Backend Layer)

**Teknoloji:** Node.js, Express, tRPC, Drizzle ORM

**Sorumluluğu:**
- API uç noktaları
- İş mantığı
- Veritabanı işlemleri
- Kimlik doğrulama ve yetkilendirme

**Dosya Yapısı:**
```
server/
├── routers/
│   ├── projects.ts            # Proje API'leri
│   ├── documents.ts           # Doküman API'leri
│   ├── inspections.ts         # Kontrol API'leri
│   ├── defects.ts             # Uygunsuzluk API'leri
│   └── reports.ts             # Rapor API'leri
├── services/
│   ├── project-service.ts
│   ├── inspection-service.ts
│   └── report-service.ts
└── db/
    ├── schema.ts              # Veritabanı şeması
    └── migrations/
```

## Veri Akışı

### Kontrol Listesi Doldurma Akışı

```
1. Kullanıcı "Kontrol Başlat" butonuna tıklar
   ↓
2. Kontrol listesi şablonu yüklenir (yerel/sunucu)
   ↓
3. Kontrol maddelerini doldurma başlar
   ↓
4. Her madde için:
   - Durumu seçer (Uygun/Uygun Değil/Kontrol Edilmedi)
   - Fotoğraf çeker (isteğe bağlı)
   - Not ekler (isteğe bağlı)
   - Doküman atıfı ekler (isteğe bağlı)
   - Ölçüm sonuçları girer (isteğe bağlı)
   ↓
5. Kontrol listesi taslak olarak kaydedilir (yerel)
   ↓
6. Kullanıcı "Gönder" butonuna tıklar
   ↓
7. Kontrol listesi sunucuya gönderilir
   ↓
8. Sunucu doğrulama yapar
   ↓
9. Veritabanına kaydedilir
   ↓
10. Raporlarda görüntülenebilir hale gelir
```

### Uygunsuzluk Yönetimi Akışı

```
1. Kontrol sırasında uygunsuzluk tespit edilir
   ↓
2. "Uygunsuzluk Raporu" oluşturulur
   ↓
3. Uygunsuzluk detayları girilir:
   - Tür, Açıklama, Şiddet
   - Fotoğraflar, Konum
   - Sorumlu kişi, Düzeltme tarihi
   ↓
4. Uygunsuzluk kaydedilir (yerel)
   ↓
5. Sunucuya senkronize edilir
   ↓
6. Sorumlu kişiye bildirim gönderilir
   ↓
7. Düzeltme süreci başlar
   ↓
8. Düzeltme fotoğrafları eklenir
   ↓
9. Uygunsuzluk kapatılır
   ↓
10. Raporlarda "Kapalı" olarak görüntülenir
```

## Çevrimdışı Senkronizasyon

Uygulama, çevrimdışı çalışma sırasında verileri yerel olarak saklar. İnternet bağlantısı geldiğinde, aşağıdaki senkronizasyon stratejisi uygulanır:

```
1. Bağlantı kontrol edilir
   ↓
2. Senkronize edilmemiş veriler tespit edilir
   ↓
3. Çakışma kontrolü yapılır
   ↓
4. Veriler sunucuya gönderilir
   ↓
5. Sunucu yanıtı alınır
   ↓
6. Yerel veriler güncellenir
   ↓
7. Senkronizasyon tamamlanır
```

## Güvenlik

### Kimlik Doğrulama
- Manus OAuth kullanıcı kimlik doğrulaması
- JWT token tabanlı oturum yönetimi
- Secure token storage (Secure Enclave / Keystore)

### Veri Şifreleme
- Transit: HTTPS/TLS
- Rest: AES-256 şifreleme (hassas veriler)
- Local: Encrypted AsyncStorage

### Yetkilendirme
- Rol tabanlı erişim kontrolü (RBAC)
- Proje seviyesi izinleri
- Veri seviyesi izinleri

## Performans Optimizasyonu

### Mobil Tarafı
- FlatList kullanarak liste performansı
- Bileşen memoization (React.memo)
- Lazy loading dokümanları
- Resim sıkıştırma ve cache'leme

### Backend Tarafı
- Veritabanı indeksleri
- Query optimization
- API response caching
- Pagination

---
